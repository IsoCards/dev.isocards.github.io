{"version":3,"sources":["webpack:///$_lazy_route_resource lazy namespace object","webpack:///src/app/app-routing.module.ts","webpack:///src/app/app.component.ts","webpack:///src/app/app.component.html","webpack:///src/app/app.module.ts","webpack:///src/app/gamemode-base.ts","webpack:///src/app/help/help.component.ts","webpack:///src/app/help/help.component.html","webpack:///src/app/home/home.component.ts","webpack:///src/app/home/home.component.html","webpack:///src/app/play/deal/deal.component.ts","webpack:///src/app/play/deal/deal.component.html","webpack:///src/app/play/game/player-game.component.ts","webpack:///src/app/play/game/player-game.component.html","webpack:///src/app/play/lobby/player-lobby.component.ts","webpack:///src/app/play/lobby/player-lobby.component.html","webpack:///src/app/play/lobby/snapshot/snapshot.component.html","webpack:///src/app/play/lobby/snapshot/snapshot.component.ts","webpack:///src/app/play/play-routing.module.ts","webpack:///src/app/play/play.component.ts","webpack:///src/app/play/play.component.html","webpack:///src/app/play/play.module.ts","webpack:///src/app/services/server/client.ts","webpack:///src/app/services/server/server.service.ts","webpack:///src/app/services/server/session.ts","webpack:///src/app/services/storage/storage.service.ts","webpack:///src/app/shared/components/connect/connect.component.ts","webpack:///src/app/shared/components/connect/connect.component.html","webpack:///src/app/shared/pipes/prompt/prompt.pipe.ts","webpack:///src/app/shared/pipes/truthy/truthy.pipe.ts","webpack:///src/app/shared/shared.module.ts","webpack:///src/app/social/game/social-game.component.ts","webpack:///src/app/social/game/social-game.component.html","webpack:///src/app/social/lobby/social-lobby.component.ts","webpack:///src/app/social/lobby/social-lobby.component.html","webpack:///src/app/social/setup/setup.component.html","webpack:///src/app/social/setup/setup.component.ts","webpack:///src/app/social/social-routing.module.ts","webpack:///src/app/social/social.component.ts","webpack:///src/app/social/social.component.html","webpack:///src/app/social/social.module.ts","webpack:///src/environments/environment.ts","webpack:///src/main.ts"],"names":["webpackEmptyAsyncContext","req","Promise","resolve","then","e","Error","code","keys","module","exports","id","routes","path","component","AppRoutingModule","forRoot","useHash","navigator","standalone","imports","AppComponent","selector","templateUrl","styleUrls","CustomHammerConfig","overrides","direction","AppModule","provide","useClass","declarations","providers","bootstrap","GameModeBase","route","router","server","storage","name","role","defaultRouteCommand","currentRouteCommand","game","client","console","log","gameStateSubscription","unsubscribe","clientStateSubscription","connectionSubscription","activeSession","socket","close","snapshot","data","connected","subscribe","onDisconnected","onConnected","lastRole","lastSession","lastToken","lastId","clear","reconnect","token","undefined","connectSession","navigate","skipLocationChange","relativeTo","routeCommand","determineRoute","state","activeClient","location","reload","processPossibleRouteChange","observableState","HelpComponent","HomeComponent","flashFrames","color","offset","PlayerDealComponent","currentRevealCard","endTurnCountdown","promptRevealOn","responseRevealOn","cardSetRevealIndex","cardSetEndReached","endTurnSeconds","helpScreensDone","session","player","hasDoneTutorials","localStorage","getItem","key","stateSubscription","subphase","setItem","promptCard","responses","drawPromptCard","revealPromptCard","gatherCards","revealPlayerCards","responseOptions","length","cardset","selectWinner","interval","setInterval","clearInterval","endTurn","event","stage","triggerName","fromState","toState","opacity","transform","animations","PlayerGameComponent","currentCard","playerHasPlayed","playerHasRedrawn","cardsPlayed","browseCount","cards","isPlayersTurn","push","playCards","map","c","filter","includes","PlayerLobbyComponent","photo","enrollPlayer","SnapshotComponent","imageType","active","videoActive","disabled","currentPhoto","emit","emitPlaceholderPhoto","window","isSecureContext","protocol","mediaDevices","disable","production","start","takePhoto","getUserMedia","video","audio","stream","nativeElement","srcObject","play","width","videoWidth","height","videoHeight","size","Math","min","canvas","context","getContext","drawImage","toDataURL","getTracks","track","stop","toggle","image","children","PlayRoutingModule","forChild","PlayComponent","exitPending","phase","enrolled","dealer","withdraw","PlayModule","Client","PlayerClient","isDealer","score","WS_URI","secureServer","serverUri","HTTP_URI","SessionInitData","ServerService","_hasReceivedClientState","_hasReceivedGameState","settings","fetch","method","body","JSON","stringify","headers","response","json","result","sessionId","hostToken","url","_connectWebSocket","addEventListener","err","_handleSocketError","ev","_handleSocketMessage","_handleSocketClose","pipe","toPromise","reject","WebSocket","onOpen","removeEventListener","onError","send","type","cardSetId","message","parse","_handleGameStateFull","_handleGameStatePatch","_handleClientStateFull","_handleClientStatePatch","_handlePlayerAdd","_handlePlayerUpdate","_handlePlayerRemove","playerData","players","observablePlayers","p","find","warn","patch","Object","assign","details","isConnected","_finishConnect","_handlePlayerClientStatePatch","providedIn","Session","hostConnected","numLurkers","numMirrors","responseDeckCount","promptDeckCount","revealedResponseCards","playersResponded","winningCard","StorageService","removeItem","value","ConnectComponent","serverService","storageService","isoCode","toUpperCase","clipboard","readText","startSession","tryPasteCode","PromptPipe","replace","TruthyPipe","items","property","item","SharedModule","SocialGameComponent","useFlipAnimationHack","userAgent","match","index","getSession","showResponseCards","SocialLobbyComponent","animate","animationRadius","minPlayers","setTimeout","writeText","startGame","endGame","bubbleOffset","sliceSize","copyCode","$event","stopPropagation","STORAGE_KEY","SetupComponent","cardDeck","useCustomDeck","load","createSession","deck","hostDetails","fileInput","click","preventDefault","dataTransfer","files","tryLoadDeck","file","reader","FileReader","prompts","Array","filename","date","Date","now","save","readAsText","deckVal","select","dragover","fileDrop","fileSelect","SocialRoutingModule","SocialComponent","SocialModule","environment","bootstrapModule","error"],"mappings":"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","file":"main-es5.js","sourcesContent":["function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = \"./$$_lazy_route_resource lazy recursive\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\nimport { HomeComponent } from './home/home.component';\nimport { HelpComponent } from './help/help.component';\nimport { environment } from 'src/environments/environment';\n\nconst routes: Routes = [\n    { path: '', component: HomeComponent },\n    { path: 'help', component: HelpComponent },\n];\n\n@NgModule({\n    imports: [RouterModule.forRoot(routes, { useHash: !!(<any>navigator).standalone || environment.useHash })],\n    exports: [RouterModule]\n})\nexport class AppRoutingModule { }\n","import { Component } from '@angular/core';\n\n@Component({\n    selector: 'app-root',\n    templateUrl: './app.component.html',\n    styleUrls: ['./app.component.scss']\n})\nexport class AppComponent {}\n","<router-outlet></router-outlet>","import { NgModule, Injectable } from '@angular/core';\nimport { BrowserModule, HammerModule, HAMMER_GESTURE_CONFIG, HammerGestureConfig } from '@angular/platform-browser';\nimport * as Hammer from 'hammerjs';\n\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\nimport { FormsModule } from '@angular/forms';\n\nimport { SharedModule } from './shared/shared.module';\n\nimport { AppRoutingModule } from './app-routing.module';\nimport { PlayModule } from './play/play.module';\nimport { SocialModule } from './social/social.module';\n\nimport { AppComponent } from './app.component';\nimport { HomeComponent } from './home/home.component';\nimport { HelpComponent } from './help/help.component';\n\n@Injectable()\nclass CustomHammerConfig extends HammerGestureConfig {\n    overrides = <any>{\n      'swipe': { direction: Hammer.DIRECTION_ALL }\n    };\n}\n\n@NgModule({\n    declarations: [\n        AppComponent,\n        HomeComponent,\n        HelpComponent,\n    ],\n    imports: [\n        BrowserModule,\n        HammerModule,\n        BrowserAnimationsModule,\n        FormsModule,\n        SharedModule, // truthy pipe not found without this for some reason\n        AppRoutingModule,\n        PlayModule,\n        SocialModule,\n    ],\n    providers: [\n        {\n            provide: HAMMER_GESTURE_CONFIG,\n            useClass: CustomHammerConfig\n        }\n    ],\n    bootstrap: [AppComponent]\n})\nexport class AppModule { }\n","import { OnInit, OnDestroy, Directive } from '@angular/core';\nimport { ServerService } from 'src/app/services/server/server.service';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { StorageService } from 'src/app/services/storage/storage.service';\nimport { Subscription } from 'rxjs';\nimport { Session } from 'src/app/services/server/session';\nimport { GameState, ClientState } from './common/interfaces';\n\n@Directive()\nexport class GameModeBase implements OnInit, OnDestroy {\n\n    name = '';\n    role = 'host';\n    defaultRouteCommand: string[] = [];\n    connectionSubscription: Subscription;\n    gameStateSubscription: Subscription;\n    clientStateSubscription: Subscription;\n\n    private currentRouteCommand: string[] = [];\n\n    constructor(protected route: ActivatedRoute, protected router: Router, public server: ServerService, protected storage: StorageService) {}\n\n    determineRoute(game: GameState, client: ClientState): string[] {\n        return null;\n    }\n\n    ngOnDestroy() {\n        console.log(`[${this.name}] OnDestroy`);\n        this.gameStateSubscription?.unsubscribe();\n        this.clientStateSubscription?.unsubscribe();\n        this.connectionSubscription?.unsubscribe();\n        // tear down the socket but leave the stored state - accidental back button can then come forward again\n        // @TODO: not ideal that the \"Join\" button on homescreen still brings us back here?\n        // maybe a 'resume' button added for recent state only with the other buttons clearing state\n        this.server?.activeSession?.socket?.close();\n    }\n\n    async ngOnInit() {\n\n        console.log(`[${this.name}] OnInit`);\n\n        if (this.route.snapshot.data.role) {\n            this.role = this.route.snapshot.data.role;\n        }\n\n        this.connectionSubscription = this.server.connected.subscribe(connected => {\n            if (!connected) this.onDisconnected();\n            else this.onConnected();\n        });\n\n        // assumption below is that there is NEVER an active session upon reaching this page\n\n        const { lastRole, lastSession, lastToken, lastId } = this.storage;\n        if (lastRole && lastRole !== this.role) {\n            console.log(`[${this.name}] role changed, clearing stored conn`);\n            this.storage.clear(); // clear the no-longer-relevant state. might want to clear only certain items\n        }\n        else if (lastSession && lastRole) {\n            console.log(`[${this.name}] stored conn detected, attempting reconnect`);\n            try {\n                const reconnect = (lastToken && lastId) ? { token: lastToken, id: lastId } : undefined;\n                // unfortunately errors below will cause an error log even though caught\n                // circumventing this would require a different method of refusing ws connections server side\n                await this.server.connectSession(lastSession, lastRole, reconnect);\n                // determineRoute will now kick in and determine where we should go\n            }\n            catch {\n                this.storage.clear(); // might want to clear only certain items\n                console.log(`[${this.name}] reconnect failed, routing to default (${this.defaultRouteCommand[0]})`);\n                this.router.navigate(this.defaultRouteCommand, { skipLocationChange: true, relativeTo: this.route });\n            }\n        }\n        else {\n            console.log(`[${this.name}] no stored conn, routing to default (${this.defaultRouteCommand[0]})`);\n            this.router.navigate(this.defaultRouteCommand, { skipLocationChange: true, relativeTo: this.route });\n        }\n    }\n\n    processPossibleRouteChange() {\n        const routeCommand = this.determineRoute(this.server.activeSession.state, this.server.activeClient.state);\n        if (!routeCommand) return;\n        if (this.currentRouteCommand[0] === routeCommand[0]) return;\n        this.currentRouteCommand = routeCommand;\n        console.log(`[${this.name}] routing to ${routeCommand[0]}`);\n        this.router.navigate(routeCommand, { skipLocationChange: true, relativeTo: this.route });\n    }\n\n    onDisconnected() {\n        console.log(`[${this.name}] disconnected`);\n        // may need to appropriately handle different circumstances e.g closed for a reason vs closed due to error?\n        // might just want to revert to connect route with a message (triggered by server close)\n        // might want to try refresh (socket error that a refresh will fix) - and message somehow only if *that* fails\n        // might want to return home (user exit?)\n\n        // if the session is really gone the failed reconnect after reload will take care of clearing storage\n        // forced reload is not ideal if this was user-driven action though\n        location.reload();\n    }\n\n    onConnected() {\n        console.log(`[${this.name}] connected`);\n        this.processPossibleRouteChange();\n        this.gameStateSubscription = this.server.activeSession.observableState.subscribe(() => this.processPossibleRouteChange());\n        this.clientStateSubscription = this.server.activeClient.observableState.subscribe(() => this.processPossibleRouteChange());\n    }\n\n    exit() {\n        // deliberate exit, clear the stored state so we don't attempt to reconnect on reload\n        this.storage.clear();\n    }\n\n}\n","import { Component, OnInit } from '@angular/core';\n\n@Component({\n    selector: 'app-help',\n    templateUrl: './help.component.html',\n    styleUrls: ['./help.component.scss']\n})\nexport class HelpComponent implements OnInit {\n\n    constructor() { }\n\n    ngOnInit(): void {\n    }\n\n}\n","<h1 class=\"page-title\">Help</h1>\n\n<div class=\"flex-pad\"></div>\n\n<img style=\"max-width: 300px;\" src=\"../../assets/TrollFace.jpg\">\n\n<br>\n\n<p class=\"page-explanation\">Welp! I haven't written any help yet.</p>\n\n<p class=\"page-explanation\">Remind me later \\_()_/</p>\n\n<div class=\"flex-pad\"></div>","import { Component, OnInit } from '@angular/core';\nimport { StorageService } from 'src/app/services/storage/storage.service';\n\n@Component({\n    selector: 'app-home',\n    templateUrl: './home.component.html',\n    styleUrls: ['./home.component.scss']\n})\nexport class HomeComponent implements OnInit {\n\n    constructor(private storage: StorageService) {}\n\n    ngOnInit(): void {\n        this.storage.clear();\n    }\n}\n","<h1 class=\"page-title\">IsoCards!</h1>\n\n<p class=\"page-explanation\">IsoCards is the card game for the modern social distancer! It seeks to retain\n    the social elements of playing cards while supporting contact-free gameplay within a single household and\n    easy extension across multiple households</p>\n\n<div class=\"flex-pad\"></div>\n\n<div class=\"button-container\">\n    <button class=\"big-button\" routerLink=\"/social\">Start Game</button>\n    <p class=\"button-caption\">(Do this on your <strong>social screen</strong>)</p>\n    <button class=\"big-button\" routerLink=\"/play\">Join Game</button>\n    <p class=\"button-caption\">(Do this on your <strong>phone</strong>)</p>\n    <button class=\"big-button\" routerLink=\"/mirror\">Extend Game</button>\n    <p class=\"button-caption\">(Extend social screen to <strong>other places</strong>)</p>\n    <button class=\"big-button\" routerLink=\"/help\">Help!</button>\n    <p class=\"button-caption\">(Do this if you're thinking <strong>WTF is this?!?</strong>)</p>\n</div>\n\n<div class=\"flex-pad\"></div>","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { trigger, transition, style, animate, keyframes } from '@angular/animations';\nimport { Subscription } from 'rxjs';\nimport { ServerService } from 'src/app/services/server/server.service';\nimport { PlayerClient } from 'src/app/services/server/client';\nimport { Session } from 'src/app/services/server/session';\nimport { GameState, Subphase, CardSet } from 'src/app/common/interfaces';\n\nconst flashFrames = keyframes([\n    style({ color: \"initial\", offset: 0 }),\n    style({ color: \"hotpink\", offset: 0.2 }),\n    style({ color: \"hotpink\", offset: 0.8 }),\n    style({ color: \"initial\", offset: 1 }),\n]);\n\n@Component({\n    selector: 'app-deal',\n    templateUrl: './deal.component.html',\n    styleUrls: ['./deal.component.scss'],\n    animations: [\n        trigger('noop', [\n            transition(':enter', animate('0s'))\n        ]),\n        trigger('flash', [\n            transition('* => *', [ animate('1s', flashFrames) ]),\n        ]),\n        trigger('modal', [\n            transition(':enter', [\n                style({ opacity: 0 }),\n                animate('200ms', style({ opacity: 1 }))\n            ]),\n            transition(':leave', [\n                style({ opacity: 1 }),\n                animate('200ms', style({ opacity: 0 }))\n            ])\n        ]),\n        trigger('fly-in', [\n            transition(':enter', [\n                style({ transform: 'translateY(-100%)' }),\n                animate('100ms', style({ transform: 'translateY(0%)' }))\n            ]),\n        ]),\n        trigger('fly-out', [\n            transition(':leave', [\n                style({ transform: 'translateY(0%)' }),\n                animate('100ms', style({ transform: 'translateY(-100%)' }))\n            ]),\n        ])\n    ],\n})\nexport class PlayerDealComponent implements OnInit, OnDestroy {\n\n    session: Session;\n    player: PlayerClient;\n    currentRevealCard = 0;\n    stateSubscription: Subscription;\n    endTurnCountdown = 3;\n\n    // animation state\n    promptRevealOn = false;\n    responseRevealOn = false;\n    cardSetRevealIndex = 0;\n    cardSetEndReached = false;\n    endTurnSeconds = 0;\n\n    // tutorial state\n    helpScreensDone = {\n        'draw-prompt': true,\n        'read-prompt': true,\n        'gather': true,\n        'announce': true,\n        'browse': true,\n        'award': true,\n    };\n\n    constructor(private server: ServerService) { }\n\n    captureSwipe() {}\n\n    ngOnInit() {\n        this.session = this.server.activeSession;\n        this.player = this.server.activeClient as PlayerClient;\n\n        const hasDoneTutorials = localStorage.getItem('dealer-tutorial-complete');\n\n        // enable tutorial screens\n        if (!hasDoneTutorials) {\n            for (const key in this.helpScreensDone) {\n                this.helpScreensDone[key] = false;\n            }\n        }\n\n        this.stateSubscription = this.session.observableState.subscribe((state: GameState) => {\n\n            if (state.subphase === Subphase.TurnBegin) {\n\n                // reset animation state\n                this.promptRevealOn = false;\n                this.responseRevealOn = false;\n                this.endTurnSeconds = 0;\n\n                // save tutorial progress\n                if (!hasDoneTutorials) {\n                    localStorage.setItem('dealer-tutorial-complete', 'true');\n                }\n            }\n\n            if (state.subphase === Subphase.DealerAnnouncingPlayerCards) {\n                this.cardSetRevealIndex = 0;\n                this.cardSetEndReached = this.session.state.promptCard.responses === 1;\n            }\n        });\n    }\n\n    ngOnDestroy() {\n        this.stateSubscription?.unsubscribe();\n    }\n\n    get statusText() {\n        switch (this.session.state.subphase) {\n            case Subphase.TurnBegin:\n                return 'Draw a Prompt';\n            case Subphase.DealerAnnouncingCard:\n                return 'Read and Reveal';\n            case Subphase.DealerAnnouncingPlayerCards:\n                if (this.session.state.promptCard.responses === 1) {\n                    return 'Read and Reveal';\n                }\n                else {\n                    return `Read and Reveal (${this.session.state.promptCard.responses} cards/player)`;\n                }\n            case Subphase.PlayersPlaying:\n                return 'Waiting on Players';\n            case Subphase.AwaitingDealerGather:\n                return 'Gather Responses';\n            case Subphase.DealerJudging:\n                return 'Pick a Winner!';\n            case Subphase.TurnResults:\n                return 'Results';\n            default:\n                return this.session.state.subphase as string;\n        }\n    }\n\n    get subStatusText() {\n        if (this.session.state.subphase === Subphase.DealerAnnouncingPlayerCards) {\n            return `${this.currentRevealCard + 1} of ${this.player.state.responseOptions.length}`;\n        }\n        else return 'Dealer';\n\n    }\n\n    drawPromptCard() {\n        this.server.drawPromptCard();\n    }\n\n    revealPromptCard() {\n        this.promptRevealOn = true;\n        this.server.revealPromptCard();\n    }\n\n    gatherCards() {\n        this.server.gatherCards();\n    }\n\n    bumpSetIndex() {\n        this.cardSetRevealIndex = ++this.cardSetRevealIndex % this.session.state.promptCard.responses;\n        if (this.cardSetRevealIndex === this.session.state.promptCard.responses - 1) {\n            this.cardSetEndReached = true;\n        }\n    }\n\n    revealPlayerCard() {\n        if (!this.cardSetEndReached) {\n            return;\n        }\n        this.cardSetRevealIndex = 0;\n        this.server.revealPlayerCards(this.player.state.responseOptions[this.currentRevealCard].id);\n        this.currentRevealCard = ++this.currentRevealCard % this.player.state.responseOptions.length;\n    }\n\n    selectWinner(cardset: CardSet) {\n        this.server.selectWinner(cardset.id);\n\n        this.endTurnSeconds = this.endTurnCountdown;\n        const interval = setInterval(() => {\n            this.endTurnSeconds--;\n            if (this.endTurnSeconds === 0) {\n                clearInterval(interval);\n            }\n        }, 1000);\n    }\n\n    endTurn() {\n        this.server.endTurn();\n    }\n\n    debugAnim(event, stage) {\n        console.log(`${event.triggerName} ${stage} (${event.fromState} => ${event.toState})`);\n    }\n\n}","<h1 class=\"page-title session-name dealer-variant\">{{session.name}}</h1>\n\n<!-- dealer view -->\n<div class=\"section dealer-variant\" [@noop]>\n\n    <span *ngIf=\"session.state.subphase !== 'turn-results'\" [@flash]=\"statusText\" class=\"hint\">{{statusText}}</span>\n\n    <!-- begin (ready to draw) -->\n    <div *ngIf=\"session.state.subphase === 'turn-begin'\" style=\"display: flex; align-items: stretch;\">\n        <div class=\"card ghost\" (swipedown)=\"drawPromptCard()\">\n            Your deal {{player.state.name}}! Grab a prompt card.\n        </div>\n    </div>\n\n    <!-- reading prompt card aloud -->\n    <div (@fly-out.done)=\"promptRevealOn = false;\" *ngIf=\"session.state.subphase === 'dealer-talking' && player.state.promptCard\">\n        <div [@fly-in] class=\"card prompt\" (swipeup)=\"revealPromptCard()\">\n            <div [innerHtml]=\"player.state.promptCard.content | prompt\"></div>\n        </div>\n    </div>\n\n    <!-- waiting for players -->\n    <div *ngIf=\"!promptRevealOn && session.state.subphase === 'players-playing'\" style=\"align-items: center;\">\n        <div class=\"flex-pad\"></div>\n        <div class=\"spinner invert\">\n            <div class=\"double-bounce1\"></div>\n            <div class=\"double-bounce2\"></div>\n        </div>\n        <div>Waiting for players</div>\n        <div class=\"flex-pad\"></div>\n    </div>\n\n    <!-- gather response cards -->\n    <div *ngIf=\"session.state.subphase === 'awaiting-dealer-gather'\">\n        <div class=\"card ghost\" (swipedown)=\"gatherCards()\">\n            Gather response cards.\n        </div>\n    </div>\n\n    <!-- read response cards -->\n    <div *ngIf=\"session.state.subphase === 'dealer-announcing-player-cards'\">\n        <div [@fly-in] class=\"card response\" (click)=\"bumpSetIndex()\" (swipeup)=\"revealPlayerCard()\">\n            <div *ngIf=\"session.state.promptCard.responses > 1\" class=\"index\">{{cardSetRevealIndex + 1}}/{{session.state.promptCard.responses}}</div>\n            <div class=\"flex-pad\"></div>\n            <div [innerHtml]=\"player.state.responseOptions[currentRevealCard].cards[cardSetRevealIndex]?.content | prompt\"></div>\n            <div class=\"flex-pad\"></div>\n        </div>\n    </div>\n\n    <!-- pick a winner -->\n    <div *ngIf=\"session.state.subphase === 'dealer-judging'\" class=\"grid-container\">\n        <div (click)=\"selectWinner(card)\" *ngFor=\"let card of player.state.responseOptions; let i = index\" class=\"card response tiny\">\n            <div class=\"number\">{{i + 1}}</div>\n        </div>\n    </div>\n\n    <span *ngIf=\"session.state.subphase !== 'turn-results'\" [@flash]=\"subStatusText\" class=\"hint\">{{subStatusText}}</span>\n\n</div>\n\n<!-- results holdup -->\n<div [@modal] *ngIf=\"session.state.subphase === 'turn-results'\" class=\"help-modal\" (swipeup)=\"captureSwipe()\">\n    <div *ngIf=\"endTurnSeconds > 0\">{{endTurnSeconds}}</div>\n    <div *ngIf=\"endTurnSeconds === 0\">Ready to Proceed?</div>\n    <div *ngIf=\"endTurnSeconds === 0\" (click)=\"endTurn()\" class=\"done\"></div>\n</div>\n\n<!-- tutorial modals -->\n<div [@modal] *ngIf=\"!helpScreensDone['draw-prompt'] && (session.state.subphase === 'turn-begin')\" class=\"help-modal\" (swipeup)=\"captureSwipe()\">\n    <div>Your deal! Swipe <strong>DOWN</strong> to draw a prompt card</div>\n    <div (click)=\"helpScreensDone['draw-prompt'] = true\" class=\"done\"></div>\n</div>\n\n<div [@modal] *ngIf=\"!helpScreensDone['read-prompt'] && (session.state.subphase === 'dealer-talking')\" class=\"help-modal\" (swipeup)=\"captureSwipe()\">\n    <div>Read out your card then swipe <strong>UP</strong> to reveal it</div>\n    <div (click)=\"helpScreensDone['read-prompt'] = true\" class=\"done\"></div>\n</div>\n\n<div [@modal] *ngIf=\"!helpScreensDone['gather'] && (session.state.subphase === 'awaiting-dealer-gather')\" class=\"help-modal\" (swipeup)=\"captureSwipe()\">\n    <div>Everyone has played a card. Swipe <strong>DOWN</strong> to gather the responses</div>\n    <div (click)=\"helpScreensDone['gather'] = true\" class=\"done\"></div>\n</div>\n\n<div [@modal] *ngIf=\"!helpScreensDone['announce'] && (session.state.subphase === 'dealer-announcing-player-cards')\" class=\"help-modal\" (swipeup)=\"captureSwipe()\">\n    <div>Read out each prompt/response combo. For each player <strong>TAP</strong> to cycle through cards (if more than one) and then swipe <strong>UP</strong> to reveal the set</div>\n    <div (click)=\"helpScreensDone['announce'] = true\" class=\"done\"></div>\n</div>\n\n<div [@modal] *ngIf=\"!helpScreensDone['browse'] && (session.state.subphase === 'dealer-judging')\" class=\"help-modal\" (swipeup)=\"captureSwipe()\">\n    <div>Time to pick a winner! <strong>TAP</strong> to pick your fave</div>\n    <div (click)=\"helpScreensDone['browse'] = true\" class=\"done\"></div>\n</div>","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { trigger, transition, style, animate, state, keyframes } from '@angular/animations';\nimport { Subscription } from 'rxjs';\nimport { ServerService } from 'src/app/services/server/server.service';\nimport { Session } from 'src/app/services/server/session';\nimport { PlayerClient } from 'src/app/services/server/client';\nimport { GameState, Subphase, PlayerClientState, Card } from 'src/app/common/interfaces';\n\ntype Anim = 'left' | 'right' | 'play' | 'draw';\n\nconst flashFrames = keyframes([\n    style({ color: \"initial\", offset: 0 }),\n    style({ color: \"hotpink\", offset: 0.2 }),\n    style({ color: \"hotpink\", offset: 0.8 }),\n    style({ color: \"initial\", offset: 1 }),\n]);\n\n@Component({\n    selector: 'app-player-game',\n    templateUrl: './player-game.component.html',\n    styleUrls: ['./player-game.component.scss'],\n    animations: [\n        trigger('noop', [\n            transition(':enter', animate('0s'))\n        ]),\n        trigger('flash', [\n            transition('* => *', [ animate('2s', flashFrames) ]),\n        ]),\n        trigger('flash-fast', [\n            transition('* => *', [ animate('1s', flashFrames) ]),\n        ]),\n        trigger('modal', [\n            transition(':enter', [\n                style({ opacity: 0 }),\n                animate('200ms', style({ opacity: 1 }))\n            ]),\n            transition(':leave', [\n                style({ opacity: 1 }),\n                animate('200ms', style({ opacity: 0 }))\n            ])\n        ]),\n        trigger('fly-in', [\n            transition(':enter', [\n                style({ transform: 'translateY(-100%)' }),\n                animate('100ms', style({ transform: 'translateY(0%)' }))\n            ]),\n        ]),\n    ],\n})\n\nexport class PlayerGameComponent implements OnInit, OnDestroy {\n\n    session: Session;\n    player: PlayerClient;\n    stateSubscription: Subscription;\n\n    // transient state, won't perisist through a reload\n    currentCard = 0;\n    playerHasPlayed = false; // = 'players-playing' AND not dealer AND not isPlayersTurn\n    playerHasRedrawn = false;\n    cardsPlayed: Card[] = [];\n\n    // tutorial state\n    browseCount = 0;\n    helpScreensDone = {\n        'browse-response': true,\n        'select-response': true,\n        'draw-new': true,\n        'enjoy': true,\n        'finish': true,\n    };\n\n    constructor(private server: ServerService) { }\n\n    captureSwipe() {}\n\n    ngOnInit() {\n\n        this.session = this.server.activeSession;\n        this.player = this.server.activeClient as PlayerClient;\n\n        const hasDoneTutorials = localStorage.getItem('player-tutorial-complete');\n\n        // enable tutorial screens\n        if (!hasDoneTutorials) {\n            for (const key in this.helpScreensDone) {\n                this.helpScreensDone[key] = false;\n            }\n        }\n\n        this.stateSubscription = this.session.observableState.subscribe((state: GameState) => {\n            // this doesn't occur when transitioning from dealer, or first visit state has already been handled before the route change\n            if (state.subphase === Subphase.TurnBegin) {\n\n                // reset client-managed state\n                this.playerHasPlayed = false;\n                this.playerHasRedrawn = false;\n                this.cardsPlayed = [];\n\n                // save tutorial progress\n                if (!hasDoneTutorials) {\n                    localStorage.setItem('player-tutorial-complete', 'true');\n                }\n            }\n        });\n    }\n\n    ngOnDestroy() {\n        this.stateSubscription?.unsubscribe();\n    }\n\n    get statusText() {\n        switch (this.session.state.subphase) {\n            case Subphase.TurnBegin:\n            case Subphase.AwaitingDealerGather:\n                return 'Waiting on Dealer'\n            case Subphase.DealerAnnouncingCard:\n            case Subphase.DealerAnnouncingPlayerCards:\n                return 'Listen to Dealer';\n            case Subphase.PlayersPlaying:\n                return this.player.state.isPlayersTurn ?\n                    `Playing card ${this.cardsPlayed.length + 1} of ${this.session.state.promptCard.responses}` :\n                    `Waiting for other Players`;\n            case Subphase.DealerJudging:\n                return 'Dealer Passing Judgement';\n            case Subphase.TurnResults:\n                return 'Results';\n            default:\n                return this.session.state.subphase as string;\n        }\n    }\n\n    get subStatusText() {\n        if (this.playerHasPlayed && !this.playerHasRedrawn) {\n            return `Need ${this.session.state.promptCard.responses} card(s)`;\n        }\n        return `${this.currentCard + 1} of ${this.cards.length}`;\n    }\n\n    get cards() {\n        return this.player.state?.cards?.filter(c => !this.cardsPlayed.includes(c)) ?? [];\n    }\n\n    nextCard() {\n        this.browseCount++;\n        this.currentCard = ++this.currentCard % this.cards.length;\n    }\n\n    previousCard() {\n        this.browseCount++;\n        this.currentCard--;\n        if (this.currentCard < 0) {\n            this.currentCard += this.cards.length;\n        }\n    }\n\n    playCurrentCard() {\n        const cards = this.cards;\n        if (!this.player.state.isPlayersTurn) return;\n        this.cardsPlayed.push(cards[this.currentCard]);\n        if (this.cardsPlayed.length === this.session.state.promptCard.responses) {\n            this.server.playCards(this.cardsPlayed.map(c => c.id));\n            this.playerHasPlayed = true;\n            this.currentCard = this.player.state.cards.length - this.session.state.promptCard.responses;\n            this.cardsPlayed = [];\n        }\n        else if (this.currentCard === (cards.length - 1)) {\n            this.currentCard = ++this.currentCard % cards.length;\n        }\n    }\n\n    drawPlayerCards() {\n        if (this.player.state.isPlayersTurn || !this.playerHasPlayed || this.playerHasRedrawn) return;\n        this.playerHasRedrawn = true;\n    }\n\n}\n","<h1 class=\"page-title session-name\">{{session.name}}</h1>\n\n<!-- player view -->\n<div class=\"section\" [@noop]>\n\n    <span [@flash]=\"statusText\" class=\"hint\">{{statusText}}</span>\n\n    <!-- card browser-->\n    <div [@fly-in] *ngIf=\"!playerHasPlayed || playerHasRedrawn\">\n        <div (swipeleft)=\"nextCard()\" (swiperight)=\"previousCard()\" (swipeup)=\"playCurrentCard()\" class=\"card reponse\">\n            <div [innerHtml]=\"cards[currentCard]?.content | prompt\"></div>\n        </div>\n    </div>\n\n    <!-- card draw -->\n    <div *ngIf=\"playerHasPlayed && !playerHasRedrawn\">\n        <div class=\"card ghost\" (swipedown)=\"drawPlayerCards()\">\n            Draw {{session.state.promptCard.responses}} new card(s)\n        </div>\n    </div>\n\n    <!-- @TODO this doesn't make sense when on card draw -->\n    <span [@flash-fast]=\"currentCard\" class=\"hint\">{{subStatusText}}</span>\n</div>\n\n<!-- tutorial modals (player) -->\n<div [@modal] *ngIf=\"!helpScreensDone['browse-response'] && (session.state.subphase === 'turn-begin' || session.state.subphase === 'dealer-talking')\" class=\"help-modal\" (swipeup)=\"captureSwipe()\">\n    <div>Listen to the Dealer's prompt</div>\n</div>\n\n<div [@modal] *ngIf=\"!helpScreensDone['browse-response'] && session.state.subphase === 'players-playing' && player.state.isPlayersTurn\" class=\"help-modal\" (swipeup)=\"captureSwipe()\">\n    <div>Swipe <strong>LEFT</strong> and <strong>RIGHT</strong> to browse your response cards</div>\n    <div (click)=\"helpScreensDone['browse-response'] = true\" class=\"done\"></div>\n</div>\n\n<div [@modal] *ngIf=\"!helpScreensDone['select-response'] && browseCount === 2 && player.state.isPlayersTurn\" class=\"help-modal\" (swipeup)=\"captureSwipe()\">\n    <div>Swipe <strong>UP</strong> to play your best response(s)</div>\n    <div (click)=\"helpScreensDone['select-response'] = true\" class=\"done\"></div>\n</div>\n\n<div [@modal] *ngIf=\"!helpScreensDone['draw-new'] && playerHasPlayed && !playerHasRedrawn\" class=\"help-modal\" (swipeup)=\"captureSwipe()\">\n    <div>Nice one! Now swipe <strong>DOWN</strong> to pick up from the deck</div>\n    <div (click)=\"helpScreensDone['draw-new'] = true\" class=\"done\"></div>\n</div>\n\n<div [@modal] *ngIf=\"!helpScreensDone['enjoy'] && playerHasPlayed && playerHasRedrawn && session.state.subphase !== 'turn-results'\" class=\"help-modal\" (swipeup)=\"captureSwipe()\">\n    <div>Enjoy the other responses and wait for the dealer to pick a winner</div>\n    <div (click)=\"helpScreensDone['enjoy'] = true\" class=\"done\"></div>\n</div>\n\n<div [@modal] *ngIf=\"!helpScreensDone['finish'] && session.state.subphase === 'turn-results'\" class=\"help-modal\" (swipeup)=\"captureSwipe()\">\n    <div>That's it. Dealer passes on and we go again. Have fun!</div>\n    <div (click)=\"helpScreensDone['finish'] = true\" class=\"done\"></div>\n</div>","import { Component, OnInit } from '@angular/core';\nimport { ServerService } from 'src/app/services/server/server.service';\nimport { Router } from '@angular/router';\n\n@Component({\n    selector: 'app-player-lobby',\n    templateUrl: './player-lobby.component.html',\n    styleUrls: ['./player-lobby.component.scss']\n})\nexport class PlayerLobbyComponent implements OnInit {\n\n    session: any = null;\n    client: any = null;\n    snapActive: boolean;\n\n    player = {\n        name: '',\n        photo: ''\n    };\n\n    constructor(private server: ServerService, private router: Router) {\n        this.session = server.activeSession;\n        this.client = server.activeClient;\n\n        // @TODO: listen for game state annd then V\n        // this.router.navigateByUrl('play', { skipLocationChange: true });\n    }\n\n    ngOnInit(): void {\n    }\n\n    submit() {\n        if (!this.player.name || !this.player.photo) return;\n        this.server.enrollPlayer(this.player.name, this.player.photo);\n    }\n\n}\n","<h1 class=\"page-title session-name\">{{session.name}}</h1>\n\n<form (submit)=\"submit()\" class=\"container\" *ngIf=\"!(client.state.enrolled)\">\n    <p class=\"page-explanation\">Set how you appear to every one on the <strong>social screen</strong></p>\n\n    <div class=\"flex-pad\"></div>\n\n    <app-snapshot (photo)=\"player.photo = $event\" (active)=\"snapActive = $event\" style=\"margin: 15px;\" type=\"image/png\"></app-snapshot>\n\n    <input [(ngModel)]=\"player.name\" placeholder=\"Name\" autocapitalize=\"off\" autocomplete=\"off\" spellcheck=\"false\" class=\"big-input subtle\" name=\"notname\">\n\n    <div class=\"flex-pad\"></div>\n\n    <button class=\"big-button\" [disabled]=\"!player.name || !player.photo || snapActive\">Ready</button>\n</form>\n\n<div class=\"container\" *ngIf=\"client.state.enrolled\">\n    <div class=\"flex-pad\"></div>\n    <div class=\"spinner\">\n        <div class=\"double-bounce1\"></div>\n        <div class=\"double-bounce2\"></div>\n    </div>\n    <div class=\"name-display\"><strong>{{client.state.name}}</strong></div>\n    <div>Waiting for host</div>\n    <div class=\"flex-pad\"></div>\n</div>","<div (click)=\"toggle()\" class=\"click-container\" [class.active]=\"videoActive\">\n    <video #video playsinline>Video stream not available.</video>\n    <div class=\"content\" [class.active]=\"videoActive\">\n        <div *ngIf=\"disabled\">Camera Unavailable</div>\n        <div *ngIf=\"!disabled && !currentPhoto || videoActive\">Tap to {{videoActive ? 'Save' : 'Snap'}}!</div>\n        <img #image *ngIf=\"!disabled && currentPhoto && !videoActive\" class=\"photo\" [src]=\"currentPhoto\">\n    </div>\n    <canvas #canvas></canvas>\n</div>","import { Component, OnInit, ViewChild, ElementRef, Output, EventEmitter, Input } from '@angular/core';\nimport { environment } from 'src/environments/environment';\n\n@Component({\n    selector: 'app-snapshot',\n    templateUrl: './snapshot.component.html',\n    styleUrls: ['./snapshot.component.scss']\n})\nexport class SnapshotComponent implements OnInit {\n\n    constructor() { }\n\n    @Input('type') imageType = 'image/jpg';\n\n    @ViewChild('video') video: ElementRef<HTMLVideoElement>;\n    @ViewChild('canvas') canvas: ElementRef<HTMLCanvasElement>;\n    @ViewChild('image') image: ElementRef<HTMLCanvasElement>;\n\n    @Output('photo') photo = new EventEmitter<string>();\n    @Output('active') active = new EventEmitter<boolean>();\n\n    videoActive = false;\n    stream: MediaStream;\n    currentPhoto: string;\n    disabled = false;\n\n    emitPlaceholderPhoto() {\n        // 1x1 black pixel\n        this.currentPhoto = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAAD5Ip3+AAAADUlEQVQIHWNgYGD4DwABBAEAHnOcQAAAAABJRU5ErkJggg==';\n        this.photo.emit(this.currentPhoto);\n    }\n\n    disable() {\n        this.disabled = true;\n        this.emitPlaceholderPhoto();\n    }\n\n    ngOnInit(): void {\n        if ((!window.isSecureContext && location.protocol !== 'https:') || !navigator.mediaDevices) {\n            this.disable();\n        }\n        else if (!environment.production) {\n            this.emitPlaceholderPhoto();\n        }\n    }\n\n    toggle() {\n        if (!this.videoActive) this.start();\n        else this.takePhoto();\n    }\n\n    async start() {\n        try {\n            this.stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });\n            this.video.nativeElement.srcObject = this.stream;\n            this.video.nativeElement.play();\n            this.videoActive = true;\n            this.active.emit(true);\n            this.disabled = false;\n        }\n        catch {\n            this.videoActive = false;\n            this.active.emit(false);\n            this.disable();\n        }\n    }\n\n    takePhoto() {\n        const width = this.video.nativeElement.videoWidth;\n        const height = this.video.nativeElement.videoHeight;\n        const size = Math.min(width, height);\n        this.canvas.nativeElement.width = this.canvas.nativeElement.height = size;\n        const context = this.canvas.nativeElement.getContext('2d');\n        context.drawImage(this.video.nativeElement, (width - size) / 2, (height - size) / 2, size, size, 0, 0, size, size);\n        this.currentPhoto = this.canvas.nativeElement.toDataURL(this.imageType);\n        this.photo.emit(this.currentPhoto);\n        this.video.nativeElement.srcObject = null;\n        for (const track of this.stream.getTracks()) {\n            track.stop();\n        }\n        this.videoActive = false;\n        this.active.emit(false);\n    }\n\n}","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { PlayComponent } from './play.component';\nimport { ConnectComponent } from '../shared/shared.module';\nimport { PlayerLobbyComponent } from './lobby/player-lobby.component';\nimport { PlayerGameComponent } from './game/player-game.component';\nimport { PlayerDealComponent } from './deal/deal.component';\n\nconst routes: Routes = [\n    {\n        path: 'play',\n        component: PlayComponent,\n        children: [\n            { path: 'connect', component: ConnectComponent, data: { role: 'player' } },\n            { path: 'lobby', component: PlayerLobbyComponent },\n            { path: 'game', component: PlayerGameComponent },\n            { path: 'deal', component: PlayerDealComponent },\n        ]\n    },\n];\n\n@NgModule({\n    imports: [RouterModule.forChild(routes)],\n    exports: [RouterModule]\n})\nexport class PlayRoutingModule { }\n","import { Component } from '@angular/core';\nimport { GameModeBase } from '../gamemode-base';\nimport { PlayerClient } from '../services/server/client';\n\n@Component({\n    selector: 'app-play',\n    templateUrl: './play.component.html',\n    styleUrls: ['./play.component.scss']\n})\nexport class PlayComponent extends GameModeBase {\n\n    name = 'PlayComponent';\n    role = 'player';\n    defaultRouteCommand = ['connect'];\n    exitPending = false;\n\n    determineRoute(): string[] {\n        if (\n            this.server.activeSession.state.phase === 'lobby' ||\n            !(this.server.activeClient as PlayerClient).state.enrolled\n        ) return ['lobby'];\n        else if (this.server.activeSession.state.phase === 'game') {\n            if (this.server.activeSession.state.dealer === this.server.activeClient.id) return ['deal'];\n            else return ['game'];\n        }\n        return null;\n    }\n\n    captureSwipe() {}\n\n    exit() {\n        // deliberate exit, clear the stored state so we don't attempt to reconnect on reload\n        this.storage.clear();\n        this.server.withdraw(); // server will close us\n    }\n}","<router-outlet></router-outlet>\n\n<button class=\"exit dealer\" [ngClass]=\"{ dealer: server?.activeClient?.state?.isDealer }\" *ngIf=\"server.activeSession\" style=\"position: absolute; top: 0; left: 0;\" (click)=\"exitPending = true\">\n    <img src=\"../../assets/close.png\">\n</button>\n\n<div [@modal] *ngIf=\"exitPending\" class=\"help-modal\" (swipeup)=\"captureSwipe()\">\n    <div>Really exit? It's permanent, you know?</div>\n    <div style=\"display: flex; flex-direction: row;\">\n        <div (click)=\"exit()\" class=\"done\"></div>\n        <div style=\"width: 10px;\"></div>\n        <div (click)=\"exitPending = false\" class=\"done\">X</div>\n    </div>\n</div>\n\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { SharedModule } from 'src/app/shared/shared.module';\n\nimport { PlayRoutingModule } from './play-routing.module';\nimport { PlayComponent } from './play.component';\n\nimport { PlayerLobbyComponent } from './lobby/player-lobby.component';\nimport { PlayerGameComponent } from './game/player-game.component';\n\nimport { SnapshotComponent } from 'src/app/play/lobby/snapshot/snapshot.component';\nimport { PlayerDealComponent } from './deal/deal.component';\n\n@NgModule({\n    declarations: [\n        PlayComponent,\n        PlayerLobbyComponent,\n        PlayerGameComponent,\n        SnapshotComponent,\n        PlayerDealComponent,\n    ],\n    imports: [\n        CommonModule,\n        SharedModule,\n        FormsModule,\n        PlayRoutingModule\n    ],\n    providers: [],\n    bootstrap: [PlayComponent]\n})\nexport class PlayModule { }\n","\nimport { EventEmitter } from '@angular/core';\nimport { Role, ClientState, PlayerClientState } from 'src/app/common/interfaces';\n\nclass Client {\n    id: string;\n    token: string;\n    role: Role;\n    state: ClientState = {};\n\n    // state emitter\n    observableState = new EventEmitter<ClientState>();\n\n    constructor() { }\n}\n\nclass PlayerClient extends Client {\n    state: PlayerClientState = {\n        name: '',\n        photo: '',\n        connected: false,\n        enrolled: false,\n        cards: [],\n        isDealer: false,\n        score: 0,\n        isPlayersTurn: false,\n        promptCard: null,\n        responseOptions: []\n    };\n\n    // state emitter\n    observableState = new EventEmitter<PlayerClientState>();\n}\n\nexport { Client, PlayerClient };\n","import { Injectable, EventEmitter } from '@angular/core';\nimport { first } from 'rxjs/operators';\nimport { environment } from 'src/environments/environment';\nimport { StorageService } from '../storage/storage.service';\nimport { Session } from './session';\nimport { Client, PlayerClient } from './client';\nimport { Message, ClientDetails, PlayerClientState, PlayerData, GameState, GameDetails, ClientState, CommandType } from 'src/app/common/interfaces';\n\nconst WS_URI = `${environment.secureServer ? 'wss' : 'ws'}://${environment.serverUri}`;\nconst HTTP_URI = `${environment.secureServer ? 'https' : 'http'}://${environment.serverUri}`;\n\nclass SessionInitData {\n    id: string;\n    name: string;\n    hostDetails: {\n        id: string,\n        token: string\n    };\n}\n\n@Injectable({\n    providedIn: 'root'\n})\nexport class ServerService {\n\n    socket: WebSocket;\n    _hasReceivedClientState = false;\n    _hasReceivedGameState = false;\n\n    activeSession: Session;\n    activeClient: Client;\n    pendingState: { client: ClientState, game: GameState };\n\n    connected = new EventEmitter<boolean>();\n    session = new EventEmitter<Session>();\n    client = new EventEmitter<Client>();\n\n    constructor(private storage: StorageService) { }\n\n    get isConnected() {\n        return this._hasReceivedGameState && this._hasReceivedClientState;\n    }\n\n    async createSession(settings) {\n        const response = await fetch(`${HTTP_URI}/session`, { method: 'POST', body: JSON.stringify(settings), headers: { 'Content-Type': 'application/json' } });\n        const result = (await response.json()) as SessionInitData; // need to check status\n        return result;\n    }\n\n    async getSession(sessionId: string, hostToken: string) {\n        const response = await fetch(`${HTTP_URI}/session/${sessionId}?token=${hostToken}`, { method: 'GET' });\n        const result = (await response.json()) as unknown; // need to check status\n        return result;\n    }\n\n    async connectSession(sessionId: string, role: string, reconnect?: { id: string, token: string }) {\n\n        // if there's already a session in place it needs to be torn down (otherwise we end up with multiple websocket connections)\n\n        let url = `${WS_URI}/session/${sessionId}?role=${role}`;\n        if (reconnect) {\n            url = `${url}&id=${reconnect.id}&token=${reconnect.token}`;\n        }\n\n        this.socket = await this._connectWebSocket(url);\n        this.socket.addEventListener('error', err => this._handleSocketError(err));\n        this.socket.addEventListener('message', ev => this._handleSocketMessage(ev));\n        this.socket.addEventListener('close', ev => this._handleSocketClose(ev));\n\n        this.activeSession = new Session(sessionId, this.socket);\n        this.activeClient = role === 'player' ? new PlayerClient() : new Client();\n\n        // until this happens activeSession/activeClient are in an undefined state\n        await this.connected.pipe(first()).toPromise();\n\n        this.storage.lastSession = sessionId;\n        this.storage.lastRole = role;\n        if (reconnect) {\n            this.storage.lastId = reconnect.id;\n            this.storage.lastToken = reconnect.token;\n        }\n    }\n\n    _connectWebSocket(url: string) {\n        return new Promise<WebSocket>((resolve, reject) => {\n\n            const socket = new WebSocket(url);\n\n            function onOpen(ev) {\n                socket.removeEventListener('open', onOpen);\n                socket.removeEventListener('error', onError);\n                resolve(socket);\n            }\n\n            function onError(err) { // ideally try and swallow the network error, don't want that in console log\n                socket.removeEventListener('open', onOpen);\n                socket.removeEventListener('error', onError);\n                reject(err);\n            }\n\n            socket.addEventListener('open', onOpen);\n            socket.addEventListener('error', onError);\n        });\n    }\n\n    enrollPlayer(name: string, photo: string) {\n        this.socket.send(JSON.stringify({ type: CommandType.PlayerEnroll, name, photo }));\n    }\n\n    withdraw() {\n        this.socket.send(JSON.stringify({ type: CommandType.Withdraw }));\n    }\n\n    startGame() {\n        this.socket.send(JSON.stringify({ type: CommandType.StartGame }));\n    }\n\n    endGame() {\n        this.socket.send(JSON.stringify({ type: CommandType.EndGame }));\n    }\n\n    drawPromptCard() {\n        this.socket.send(JSON.stringify({ type: CommandType.DrawDealerCard }));\n    }\n\n    revealPromptCard() {\n        this.socket.send(JSON.stringify({ type: CommandType.RevealDealerCard }));\n    }\n\n    playCards(cards: number[]) {\n        this.socket.send(JSON.stringify({ type: CommandType.PlayCards, cards }));\n    }\n\n    gatherCards() {\n        this.socket.send(JSON.stringify({ type: CommandType.GatherCards }));\n    }\n\n    revealPlayerCards(cardSetId: string) {\n        this.socket.send(JSON.stringify({ type: CommandType.RevealPlayerCards, cardSetId }));\n    }\n\n    selectWinner(cardSetId: string) {\n        this.socket.send(JSON.stringify({ type: CommandType.SelectWinner, cardSetId }));\n    }\n\n    endTurn() {\n        this.socket.send(JSON.stringify({ type: CommandType.EndTurn }));\n    }\n\n    _finishConnect() {\n        // emit first, crucial details available (ids etc)\n        this.connected.emit(true);\n    }\n\n    _handleSocketError(ev: Event) { // there's a chance a reconnect could fix this\n        console.log('socket error');\n        this.connected.emit(false);\n        this._hasReceivedClientState = false;\n        this._hasReceivedGameState = false\n        this.activeSession = null;\n        this.activeClient = null;\n    }\n\n    _handleSocketClose(ev: CloseEvent) { // there's a chance a reconnect could fix this\n        console.log('socket closed');\n        this.connected.emit(false);\n        this._hasReceivedClientState = false;\n        this._hasReceivedGameState = false\n        this.activeSession = null;\n        this.activeClient = null;\n    }\n\n    _handleSocketMessage(ev: MessageEvent) {\n        console.log(`Message received: ${ev.data}`);\n\n        const message = JSON.parse(ev.data) as Message;\n\n        if (message.type === 'game-state-full') {\n            this._handleGameStateFull(message.game);\n        }\n        else if (message.type === 'game-state-patch') {\n            this._handleGameStatePatch(message.state);\n        }\n        else if (message.type === 'client-state-full') {\n            this._handleClientStateFull(message.client);\n        }\n        else if (message.type === 'client-state-patch') {\n            this._handleClientStatePatch(message.state);\n        }\n        else if (message.type === 'player-add') {\n            this._handlePlayerAdd(message.player);\n        }\n        else if (message.type === 'player-update') {\n            this._handlePlayerUpdate(message.id, message.state);\n        }\n        else if (message.type === 'player-remove') {\n            this._handlePlayerRemove(message.id);\n        }\n    }\n\n    _handlePlayerAdd(player: ClientDetails<PlayerClientState>) { // @TODO not quite the right input type. Server should send only what we need\n        const playerData: PlayerData = {\n            id: player.id,\n            connected: player.state.connected,\n            enrolled: player.state.enrolled,\n            name: player.state.name,\n            photo: player.state.photo,\n            score: player.state.score,\n        };\n        this.activeSession.players = [...this.activeSession.players, playerData];\n        this.activeSession.observablePlayers.emit(this.activeSession.players);\n    }\n\n    _handlePlayerRemove(id: string) {\n        this.activeSession.players = this.activeSession.players.filter(p => p.id !== id);\n        this.activeSession.observablePlayers.emit(this.activeSession.players);\n    }\n\n    _handlePlayerUpdate(id: string, state: Partial<PlayerClientState>) {\n        // this is ugly but for now the received info Partial<PlayerClientState> is a superset of the PlayerData we're interested in\n        const player = this.activeSession.players.find(p => p.id === id);\n        if (!player) {\n            console.warn('Received player update for a player not currently tracked. Ignoring');\n            return;\n        }\n        if ('enrolled' in state) {\n            player.enrolled = state.enrolled;\n        }\n        if ('connected' in state) {\n            player.connected = state.connected;\n        }\n        if ('name' in state) {\n            player.name = state.name;\n        }\n        if ('photo' in state) {\n            player.photo = state.photo;\n        }\n        if ('score' in state) {\n            player.score = state.score;\n        }\n\n        // forces updates so anything that applies a pipe to the player list will be re-run\n        this.activeSession.players = [...this.activeSession.players];\n    }\n\n    _handleGameStatePatch(patch: Partial<GameState>) {\n        const state = Object.assign(this.activeSession.state, patch);\n        this.activeSession.state = Object.assign(this.activeSession.state, patch);\n        this.activeSession.observableState.emit(this.activeSession.state);\n    }\n\n    _handleGameStateFull(details: GameDetails) {\n\n        // happens once on first connect\n        this.activeSession.name = details.name;\n        this.activeSession.id = details.id;\n        this._handleGameStatePatch(details.state);\n\n        // if we've already received client state but weren't already connected we now are\n        if (!this.isConnected) {\n            this._hasReceivedGameState = true;\n            if (this.isConnected) this._finishConnect();\n        }\n    }\n\n    _handleClientStatePatch(patch: Partial<ClientState>) {\n        if (this.activeClient.role === 'player') {\n            this._handlePlayerClientStatePatch(patch as Partial<PlayerClientState>);\n        }\n        // none of the others have state yet\n    }\n\n    _handlePlayerClientStatePatch(patch: Partial<PlayerClientState>) {\n        const client = this.activeClient as PlayerClient;\n        client.state = Object.assign(client.state, patch);\n\n        // store reconnect details\n        // @TODO storage service should be in charge of listening for and actioning this. not server's job\n        if (patch.enrolled === true) {\n            this.storage.lastId = client.id;\n            this.storage.lastToken = client.token;\n        }\n\n        this.activeClient.observableState.emit(this.activeClient.state);\n    }\n\n    _handleClientStateFull(details: ClientDetails<ClientState>)\n    {\n        this.activeClient.id = details.id;\n        this.activeClient.role = details.role;\n        this.activeClient.token = details.token;\n        this._handleClientStatePatch(details.state);\n\n        // store reconnect details if host (mirror doesn't store reconnect details at all and player stores later once enrolled)\n        // @TODO storage service should be in charge of listening for and actioning this. not server's job\n        if (this.activeClient.role === 'host') {\n            this.storage.lastId = details.id;\n            this.storage.lastToken = details.token;\n        }\n\n        if (this.activeClient.role === 'player') {\n            this._handlePlayerClientStatePatch(details.state as Partial<PlayerClientState>);\n        }\n\n        // if we've already received game state but weren't already connected we now are\n        if (!this.isConnected) {\n            this._hasReceivedClientState = true;\n            if (this.isConnected) this.connected.emit(true);\n        }\n    }\n}\n","import { EventEmitter } from '@angular/core';\nimport { GameState, Subphase, PlayerData } from 'src/app/common/interfaces';\n// import { GameState, Phase, PlayerData } from './server.service';\n\nclass Session {\n\n    name = '';\n    players: PlayerData[] = [];\n    state: GameState = {\n        hostConnected: false,\n        phase: 'unknown',\n        numLurkers: 0,\n        numMirrors: 0,\n        responseDeckCount: 0,\n        promptDeckCount: 0,\n        dealer: '',\n        subphase: Subphase.TurnBegin,\n        revealedResponseCards: [],\n        playersResponded: [],\n        promptCard: null,\n        winningCard: null\n    };\n\n    // player list emitter\n    observablePlayers = new EventEmitter<PlayerData[]>();\n\n    // state emitter\n    observableState = new EventEmitter<GameState>();\n\n    constructor(public id: string, public socket: WebSocket) {}\n}\n\nexport { Session };\n","import { Injectable } from '@angular/core';\n\n@Injectable({\n    providedIn: 'root'\n})\nexport class StorageService {\n\n    #lastSession: string = null;\n    #lastRole: string = null;\n    #lastToken: string = null;\n    #lastId: string = null;\n\n    constructor() {\n        this.#lastSession = localStorage.getItem('lastSession');\n        this.#lastRole = localStorage.getItem('lastRole');\n        this.#lastToken = localStorage.getItem('lastToken');\n        this.#lastId = localStorage.getItem('lastId');\n    }\n\n    set lastSession(value) {\n        this.#lastSession = value;\n        localStorage.setItem('lastSession', this.#lastSession);\n    }\n\n    get lastSession() {\n        return this.#lastSession;\n    }\n\n    set lastRole(value) {\n        this.#lastRole = value;\n        localStorage.setItem('lastRole', this.#lastRole);\n    }\n\n    get lastRole() {\n        return this.#lastRole;\n    }\n\n    set lastToken(value) {\n        this.#lastToken = value;\n        localStorage.setItem('lastToken', this.#lastToken || '');\n    }\n\n    get lastToken() {\n        return this.#lastToken;\n    }\n\n    set lastId(value) {\n        this.#lastId = value;\n        localStorage.setItem('lastId', this.#lastId || '');\n    }\n\n    get lastId() {\n        return this.#lastId;\n    }\n\n    clear() {\n        localStorage.removeItem('lastId');\n        localStorage.removeItem('lastToken');\n        localStorage.removeItem('lastRole');\n        localStorage.removeItem('lastSession');\n    }\n}\n","import { Component, OnInit } from '@angular/core';\nimport { ServerService } from 'src/app/services/server/server.service';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { StorageService } from 'src/app/services/storage/storage.service';\nimport { environment } from 'src/environments/environment';\n\n@Component({\n    selector: 'app-connect',\n    templateUrl: './connect.component.html',\n    styleUrls: ['./connect.component.scss']\n})\nexport class ConnectComponent implements OnInit {\n\n    isoCode = '';\n    role = 'player';\n\n    constructor(private serverService: ServerService, private storageService: StorageService, private router: Router, private route: ActivatedRoute) {\n        this.role = route.snapshot.data.role;\n    }\n\n    ngOnInit(): void { }\n\n    async startSession() {\n\n        if (this.isoCode?.length !== 6) return;\n\n        if (this.role === 'mirror') {\n            await this.serverService.connectSession(this.isoCode.toUpperCase(), 'mirror');\n        }\n        else {\n            await this.serverService.connectSession(this.isoCode.toUpperCase(), 'player');\n        }\n    }\n\n    async tryPasteCode() {\n        // shortcut for dev\n        if (environment.production) return;\n        try {\n            const code = await navigator.clipboard.readText();\n            if (code.length === 6) this.isoCode = code;\n        }\n        catch {}\n    }\n}\n","<div class=\"banner\">{{role}}</div>\n\n<div class=\"narrow-container\">\n\n    <h1 class=\"page-title\">Enter IsoCode</h1>\n\n    <p class=\"page-explanation\">The IsoCode for your game can be found on the <strong>Social Screen</strong> (or one of\n        it's mirrors)</p>\n\n    <form (submit)=\"startSession()\" class=\"form-container\">\n\n        <input [(ngModel)]=\"isoCode\" (focus)=\"tryPasteCode()\" class=\"big-input isocode-entry\" placeholder=\"ISOCODE\"\n            autocapitalize=\"off\" autocomplete=\"off\" autofocus maxlength=\"6\" name=\"isocode\">\n\n        <div class=\"flex-pad\"></div>\n\n        <button type=\"submit\" class=\"big-button\"\n            [disabled]=\"isoCode?.length !== 6\">{{role === 'player' ? 'Join' : 'Mirror'}}</button>\n\n    </form>\n\n</div>","import { Pipe, PipeTransform } from '@angular/core';\n\n@Pipe({\n    name: 'prompt'\n})\nexport class PromptPipe implements PipeTransform {\n    transform(value: string): unknown {\n        return value ? value.replace(/\\*\\*\\*/g, '________') : '';\n    }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\n@Pipe({\n    name: 'truthy'\n})\nexport class TruthyPipe implements PipeTransform {\n    transform(items: any[], property: string) {\n        return items.filter(item => item[property]);\n    }\n}","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { ConnectComponent } from './components/connect/connect.component';\nimport { TruthyPipe } from './pipes/truthy/truthy.pipe';\nimport { PromptPipe } from './pipes/prompt/prompt.pipe';\n\n@NgModule({\n    declarations: [\n        ConnectComponent,\n        TruthyPipe,\n        PromptPipe,\n    ],\n    imports: [\n        CommonModule,\n        FormsModule,\n    ],\n    exports: [\n        ConnectComponent,\n        TruthyPipe,\n        PromptPipe,\n    ]\n})\nexport class SharedModule { }\n\nexport { ConnectComponent };\n","import { Component, OnInit } from '@angular/core';\nimport { keyframes, style, trigger, transition, animate } from '@angular/animations';\nimport { ServerService } from 'src/app/services/server/server.service';\nimport { Session } from 'src/app/services/server/session';\nimport { Client } from 'src/app/services/server/client';\nimport { PlayerData, Subphase } from 'src/app/common/interfaces';\n\nconst flashFrames = keyframes([\n    style({ color: \"initial\", offset: 0 }),\n    style({ color: \"hotpink\", offset: 0.2 }),\n    style({ color: \"hotpink\", offset: 0.8 }),\n    style({ color: \"initial\", offset: 1 }),\n]);\n\n@Component({\n    selector: 'app-social-game',\n    templateUrl: './social-game.component.html',\n    styleUrls: ['./social-game.component.scss'],\n    animations: [\n        trigger('flash', [\n            transition('* => *', [ animate('1s', flashFrames) ]),\n        ]),\n    ]\n})\nexport class SocialGameComponent implements OnInit {\n\n    session: Session;\n    client: Client;\n\n    useFlipAnimationHack = navigator.userAgent.match('PlayStation 4');\n\n    constructor(private server: ServerService) { }\n\n    get dealer() {\n        return this.session.players.find(p => this.session.state.dealer === p.id);\n    }\n\n    get otherPlayers() {\n        return this.session.players.find(p => this.session.state.dealer !== p.id);\n    }\n\n    index = 0;\n\n    ngOnInit() {\n        this.session = this.server.activeSession;\n        this.client = this.server.activeClient;\n        this.index = 0;\n\n        // @TODO only have this active while in the right phase. Reset index to zero and timer everytime a new card is added?\n        setInterval(() => {\n            if (this.session.state.promptCard) {\n                this.index = ++this.index % this.session.state.promptCard.responses;\n            }\n            else {\n                this.index = 0;\n            }\n        }, 1500);\n\n        setInterval(() => {\n            // keep server alive\n            this.server.getSession(this.session.id, this.client.token);\n        }, 60000);\n    }\n\n    getPlayerById(id: string) {\n        return this.session.players.find(p => p.id === id);\n    }\n\n    get players() {\n        return this.session.players.filter(p => p.enrolled);\n    }\n\n    get dealerFlipped() {\n        return !!this.session.state.promptCard;\n    }\n\n    get showPlayerResponses() {\n        return !this.showResponseCards;\n    }\n\n    get showResponseCards() {\n        return [Subphase.DealerAnnouncingPlayerCards, Subphase.DealerJudging, Subphase.TurnResults].includes(this.session.state.subphase);\n    }\n\n}\n","<div class=\"header-row\">\n    <h1 class=\"page-title session-name\">{{session.name}}</h1>\n    <div class=\"isocode-box\">\n        {{session.id}}\n    </div>\n</div>\n\n<div *ngIf=\"session.state.subphase === 'turn-begin'\" class=\"turn-begin\">\n    <div class=\"spinner\">\n        <div class=\"double-bounce1\"></div>\n        <div class=\"double-bounce2\"></div>\n    </div>\n    <div>{{getPlayerById(session.state.dealer)?.name}}'s Deal</div>\n</div>\n\n<div *ngIf=\"session.state.subphase !== 'turn-begin'\" class=\"game-section\">\n\n    <!-- dealer card -->\n    <div class=\"flip-card responsive-card\" *ngIf=\"session.state.subphase === 'dealer-talking' || session.state.promptCard\" [ngClass]=\"{ flip: dealerFlipped, fliphack: useFlipAnimationHack }\">\n        <div class=\"flip-card-inner\">\n            <div class=\"flip-card-content card dealer prompt\">\n                <img class=\"card-image\" [src]=\"getPlayerById(session.state.dealer)?.photo\" style=\"box-sizing: border-box; border: 2px solid white;\">\n                <!-- {{getPlayerById(session.state.dealer)?.name}} -->\n            </div>\n            <div class=\"flip-card-content card dealer prompt back\">\n                <div [innerHtml]=\"(session.state.promptCard?.content | prompt) || ''\"></div>\n            </div>\n        </div>\n    </div>\n\n    <!-- response card player logos (these don'tneed to be flippable) -->\n    <div *ngFor=\"let playerId of session.state.playersResponded\">\n        <div class=\"flip-card responsive-card\" *ngIf=\"showPlayerResponses\">\n            <div class=\"flip-card-inner\">\n                <div class=\"flip-card-content card dealer response\">\n                    <img class=\"card-image\" [src]=\"getPlayerById(playerId)?.photo\">\n                    <!-- {{getPlayerById(playerId)?.name}} -->\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- actual response cards -->\n    <div *ngFor=\"let cardSet of session.state.revealedResponseCards; let i = index\">\n        <div class=\"flip-card responsive-card\" *ngIf=\"showResponseCards\" [ngClass]=\"{ fullflip: session.state.winningCard?.cardSetId === cardSet.id, fliphack: useFlipAnimationHack }\">\n            <div class=\"flip-card-inner\">\n                <div class=\"flip-card-content card dealer response\">\n                    <div *ngIf=\"session.state.promptCard.responses > 1\" class=\"index\">{{index + 1}}/{{session.state.promptCard.responses}}</div>\n                    <div class=\"flex-pad\"></div>\n                    <div [innerHtml]=\"cardSet.cards[index].content | prompt\"></div>\n                    <div class=\"flex-pad\"></div>\n                    <div class=\"number\">{{i + 1}}</div>\n                </div>\n                <div *ngIf=\"session.state.winningCard?.cardSetId === cardSet.id\" class=\"flip-card-content card dealer response back\">\n                    <img class=\"card-image\" [src]=\"getPlayerById(session.state.winningCard.player).photo\">\n                </div>\n            </div>\n        </div>\n    </div>\n\n</div>\n\n<div *ngIf=\"dealer\" class=\"stats-section\">\n\n    <div [@flash]=\"session.state.responseDeckCount\" class=\"card response deck\">{{session.state.responseDeckCount}}</div>\n\n    <div class=\"flex-pad\"></div>\n\n    <div class=\"player-row\">\n        <div *ngFor=\"let player of players\" class=\"player\" [ngClass]=\"{ dealer: session.state.dealer === player.id }\">\n            <img [src]=\"player.photo\">\n            <div class=\"name\">{{player.name}} ({{player.score}} pts)</div>\n        </div>\n    </div>\n\n    <div class=\"flex-pad\"></div>\n\n    <div [@flash]=\"session.state.promptDeckCount\" class=\"card prompt deck\">{{session.state.promptDeckCount}}</div>\n\n</div>","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\n\nimport { environment } from 'src/environments/environment';\n\nimport { ServerService } from 'src/app/services/server/server.service';\nimport { Session } from 'src/app/services/server/session';\n\n@Component({\n    selector: 'app-social-lobby',\n    templateUrl: './social-lobby.component.html',\n    styleUrls: ['./social-lobby.component.scss'],\n})\nexport class SocialLobbyComponent implements OnInit {\n\n    session: Session = null;\n    role = 'host';\n    animate = true;\n    animationRadius = '140px';\n\n    minPlayers = environment.production ? 3 : 2; // this should be server-side\n\n    constructor(private serverService: ServerService, route: ActivatedRoute) {\n        this.session = serverService.activeSession;\n        this.role = route.snapshot.data.role;\n    }\n\n    ngOnInit(): void {\n        this.session.observablePlayers.subscribe(() => {\n            // reset the animation class on all elements to keep them in sync\n            this.animate = false;\n            // time value here is hit and miss. 10 usually not enough to trigger anim restart\n            setTimeout(() => { this.animate = true }, 50);\n        });\n    }\n\n    copyCode() {\n        navigator.clipboard.writeText(this.session.id);\n    }\n\n    startGame() {\n        this.serverService.startGame();\n    }\n\n    cancelGame() {\n        this.serverService.endGame();\n    }\n\n    bubbleTransform(index: number) {\n        const offset = this.bubbleOffset(index);\n        return `rotate(${offset}) translateX(${this.animationRadius}) rotate(-${offset})`;\n    }\n\n    bubbleOffset(index: number) {\n        const sliceSize = 360 / this.session.players.length;\n        return `${sliceSize * index}deg`;\n    }\n}\n","<div *ngIf=\"role === 'host'\" class=\"banner\">{{role}} ({{session.state.numMirrors}} mirrors)</div>\n<div *ngIf=\"role === 'mirror'\" class=\"banner\">{{role}} ({{session.state.numMirrors}} total)</div>\n\n<div class=\"header-row\">\n    <h1 class=\"page-title session-name\">{{session.name}}</h1>\n    <div class=\"isocode-box\" (click)=\"copyCode()\">\n        {{session.id}}\n    </div>\n</div>\n\n<p class=\"narrow-element page-explanation\">This is the social lobby where we wait for everyone to join the game using the\n    <strong>IsoCode</strong> above. As you can see, games are given <strong>fun names</strong> so everyone knows\n    they're in the right place. <strong>Lurkers</strong> are the peasants who've connected but haven't yet\n    registered to play.\n</p>\n\n<div class=\"flex-pad\"></div>\n\n<div class=\"player-box\">\n    <div class=\"spinner\">\n        <!--we use CSS custom properties (vars) to inject params via inline element style which are then used by predefined CSS keyframes for parameterised animation-->\n        <!--we can't return custom properties (--property) via ngClass atm (https://github.com/angular/angular/issues/9343)-->\n        <!--but we CAN do separate [style.--prop] for those-->\n        <!--separately, CSS vars not well supported on Xbox/Smart TV, so also fall back to non-animated inline transform-->\n        <div *ngFor=\"let player of session.players; let i = index\" class=\"bubble\" [class.animate]=\"animate\"\n            [style.transform]=\"bubbleTransform(i)\" [style.--i]=\"i\" [style.--n]=\"session.players.length\" [style.--offset]=\"bubbleOffset(i)\" [style.--radius]=\"animationRadius\">\n            <img *ngIf=\"player.photo\" [src]=\"player.photo\">\n            <div class=\"lurker\" *ngIf=\"!player.photo\">\n                ?\n            </div>\n            <div>{{player.name || 'Lurker'}}</div>\n        </div>\n        <div class=\"double-bounce1\"></div>\n        <div class=\"double-bounce2\"></div>\n        <div class=\"spinner-text\">{{(session.players | truthy: 'enrolled').length}} / {{minPlayers}}</div>\n    </div>\n</div>\n\n<div class=\"flex-pad\"></div>\n\n<button class=\"big-button\" (click)=\"startGame()\" *ngIf=\"role === 'host'\" [disabled]=\"(session.players | truthy: 'enrolled').length < minPlayers\">Start Game</button>\n","<h1 class=\"page-title\">Game Setup</h1>\n\n<p class=\"page-explanation\">You can provide your own custom deck if you don't want to play with the peasant default deck. This will be stored locally in your browser to save some dicking around next time. It <strong>won't</strong> be stored anywhere other than your browser.</p>\n\n<p class=\"page-explanation\">We don't have any other settings yet. Soz...</p>\n\n<div style=\"display: flex; align-items: center; margin: 10px;\">\n    <input name=\"custom\" type=\"checkbox\" [checked]=\"useCustomDeck\" (change)=\"useCustomDeck = !useCustomDeck\">\n    &nbsp;<label for=\"custom\">Use custom deck</label>\n</div>\n\n<div class=\"flex-pad\"></div>\n\n<div (click)=\"select()\" (dragover)=\"dragover($event)\" (drop)=\"fileDrop($event)\" class=\"dropzone\">\n    <div *ngIf=\"useCustomDeck && !cardDeck\">No custom deck loaded. Drag one here or click to select.</div>\n    <div *ngIf=\"useCustomDeck && cardDeck\" style=\"margin: 5px;\">\n        <div><strong>{{cardDeck.name}} ({{cardDeck.filename}})</strong></div>\n        <div><strong>{{cardDeck.prompts.length}}</strong> prompt cards</div>\n        <div><strong>{{cardDeck.responses.length}}</strong> response cards</div>\n        <div><strong>Stored since:</strong></div>\n        <div>{{cardDeck.date | date: 'medium'}}</div>\n        <button *ngIf=\"cardDeck\" class=\"inverse\" style=\"font-size: 0.8em; margin: 5px;\" (click)=\"clear(); $event.stopPropagation()\">Delete</button>\n    </div>\n    <div *ngIf=\"!useCustomDeck\" style=\"margin: 5px;\">\n        <div>Using default deck</div>\n        <div>\n            Courtesy of <a (click)=\"$event.stopPropagation()\" style=\"color: white;\" target=\"_\" href=\"https://cardsagainsthumanity.com\">Cards Against Humanity</a>\n        </div>\n        <div>\n            <a (click)=\"$event.stopPropagation()\" style=\"color: white; font-size: 0.7em;\" target=\"_\" href=\"https://creativecommons.org/licenses/by-nc-sa/2.0/\">Creative Commons BY-NC-SA 2.0 License</a>\n        </div>\n    </div>\n</div>\n\n<input #fileinput (change)=\"fileSelect()\" type=\"file\" multiple=\"false\" accept=\".json,.cards\" id=\"file-input\">\n\n<div class=\"flex-pad\"></div>\n\n<button [disabled]=\"useCustomDeck && !cardDeck\" class=\"big-button\" (click)=\"start()\">Start</button>","import { Component, OnInit, ElementRef, ViewChild } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { ServerService } from 'src/app/services/server/server.service';\nimport { CardDeck } from 'src/app/common/interfaces';\n\nconst STORAGE_KEY = 'isocard-deck';\n\n@Component({\n    selector: 'app-setup',\n    templateUrl: './setup.component.html',\n    styleUrls: ['./setup.component.scss']\n})\nexport class SetupComponent implements OnInit {\n\n    @ViewChild('fileinput') fileInput: ElementRef<HTMLInputElement>;\n    cardDeck: CardDeck = null;\n    useCustomDeck = false;\n\n    constructor(private router: Router, private serverService: ServerService) { }\n\n    ngOnInit(): void {\n        this.load();\n    }\n\n    async start() {\n        const session = await this.serverService.createSession({ deck: this.useCustomDeck ? this.cardDeck : undefined });\n        await this.serverService.connectSession(session.id, 'host', session.hostDetails);\n    }\n\n    select() {\n        this.fileInput.nativeElement.click();\n    }\n\n    dragover(event: DragEvent) {\n        event.preventDefault();\n    }\n\n    fileDrop(event: DragEvent) {\n        event.preventDefault();\n        if (event.dataTransfer.files.length === 1) {\n            this.tryLoadDeck(event.dataTransfer.files[0]);\n        }\n    }\n\n    tryLoadDeck(file: File) {\n        try {\n            const reader = new FileReader();\n            reader.addEventListener('load', (ev) => {\n                const cards = JSON.parse(reader.result as string);\n                if (cards.prompts instanceof Array && cards.responses instanceof Array && typeof cards.name === 'string') {\n                    if (cards.prompts.length > 10 && cards.responses.length > 20) {\n                        this.cardDeck = { name: cards.name, filename: file.name, date: Date.now(), prompts: cards.prompts, responses: cards.responses };\n                        this.useCustomDeck = true;\n                        this.save(this.cardDeck);\n                    }\n                }\n            });\n            reader.readAsText(file);\n            event.preventDefault();\n        }\n        catch {\n            console.warn('[SetupComponent] Unable to load deck file');\n        }\n    }\n\n    fileSelect() {\n        if (this.fileInput.nativeElement.files.length === 1) {\n            this.tryLoadDeck(this.fileInput.nativeElement.files[0]);\n        }\n    }\n\n    save(cardDeck: CardDeck) {\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(cardDeck));\n    }\n\n    clear() {\n        localStorage.removeItem(STORAGE_KEY);\n        this.fileInput.nativeElement.value = \"\";\n        this.cardDeck = null;\n        this.useCustomDeck = false;\n    }\n\n    load() {\n        const deckVal = localStorage.getItem(STORAGE_KEY);\n        if (deckVal !== null) {\n            this.cardDeck = JSON.parse(deckVal);\n            this.useCustomDeck = true;\n        }\n    }\n\n}\n","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { SocialComponent } from './social.component';\nimport { SetupComponent } from './setup/setup.component';\nimport { SocialLobbyComponent } from './lobby/social-lobby.component';\nimport { SocialGameComponent } from './game/social-game.component';\nimport { ConnectComponent } from '../shared/components/connect/connect.component';\n\nconst routes: Routes = [\n    {\n        path: 'social',\n        component: SocialComponent,\n        children: [\n            { path: 'setup', component: SetupComponent },\n            { path: 'lobby', component: SocialLobbyComponent, data: { role: 'host' } },\n            { path: 'game', component: SocialGameComponent, data: { role: 'host' } },\n        ],\n        data: { role: 'host' }\n    },\n    {\n        path: 'mirror',\n        component: SocialComponent,\n        children: [\n            { path: 'setup', component: ConnectComponent, data: { role: 'mirror' } },\n            { path: 'lobby', component: SocialLobbyComponent, data: { role: 'mirror' } },\n            { path: 'game', component: SocialGameComponent, data: { role: 'mirror' } },\n        ],\n        data: { role: 'mirror' }\n    },\n];\n\n@NgModule({\n    imports: [RouterModule.forChild(routes)],\n    exports: [RouterModule]\n})\nexport class SocialRoutingModule { }\n","import { Component } from '@angular/core';\nimport { GameModeBase } from '../gamemode-base';\nimport { GameState } from '../common/interfaces';\n\n@Component({\n    selector: 'app-social',\n    templateUrl: './social.component.html',\n    styleUrls: ['./social.component.scss']\n})\nexport class SocialComponent extends GameModeBase {\n\n    name = 'SocialComponent';\n    role = 'host'; // will be overriden by route data in base class\n    defaultRouteCommand = ['setup'];\n\n    determineRoute(state: GameState) {\n        if (state.phase === 'lobby') return ['lobby'];\n        else if (state.phase === 'game') return ['game'];\n        return null;\n    }\n\n    exit() {\n        super.exit();\n        if (this.role === 'host') {\n            this.server.endGame();\n        }\n        else {\n            this.server.socket?.close();\n        }\n    }\n\n}\n","<router-outlet></router-outlet>\n\n<button class=\"exit\" *ngIf=\"server.activeSession\" style=\"position: absolute; top: 0; left: 0;\" (click)=\"exit()\">\n    <img src=\"../../assets/close.png\">\n</button>","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { SharedModule } from 'src/app/shared/shared.module';\n\nimport { SocialRoutingModule } from './social-routing.module';\nimport { SocialComponent } from './social.component';\n\nimport { SetupComponent } from './setup/setup.component';\nimport { SocialLobbyComponent } from './lobby/social-lobby.component';\nimport { SocialGameComponent } from './game/social-game.component';\n\n@NgModule({\n    declarations: [\n        SocialComponent,\n        SetupComponent,\n        SocialLobbyComponent,\n        SocialGameComponent,\n    ],\n    imports: [\n        CommonModule,\n        FormsModule,\n        SharedModule,\n        SocialRoutingModule,\n    ],\n    providers: [],\n    bootstrap: [SocialComponent]\n})\nexport class SocialModule { }\n","export const environment = {\n    production: true,\n    serverUri: 'isocards-staging.herokuapp.com',\n    secureServer: true,\n    useHash: true,\n};\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\nimport 'hammerjs';\n\nif (environment.production) {\n    enableProdMode();\n}\n\nplatformBrowserDynamic().bootstrapModule(AppModule)\n    .catch(err => console.error(err));\n"]}